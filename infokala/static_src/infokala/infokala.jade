doctype html
html
  head
    meta(charset='UTF-8')
    title Infokala
    link(rel='stylesheet', href='/static/infokala/bootstrap.min.css')
    link(rel='stylesheet', href='/static/infokala/infokala.css')
    meta(name="viewport", content="width=device-width, initial-scale=1")
    script(defer, src='config.js')
    script(defer, src='/static/infokala/infokala.js')
  body
    .navbar.navbar-default.navbar-fixed-top
      .container
        .navbar-header
          a.navbar-brand(href) Infokala
        .collapse.navbar-collapse#base-navbar-collapse(style='display: none', data-bind='visible: true')
          ul.nav.navbar-nav(data-bind='foreach: messageTypeFilters')
            li(data-bind='css: { active: slug === $parent.activeFilter().slug }')
              a(href, data-bind='text: name, click: $parent.activeFilter')
          ul.nav.navbar-nav.navbar-right
            li.dropdown
              a.dropdown-toggle(href, data-toggle='dropdown')
                span(data-bind='text: config.user.displayName')
                b.caret
              ul.dropdown-menu
                li: a(href, data-bind='attr: { href: config.logoutUrl }') Kirjaudu ulos

    .infokala-push-top

    .container(style='display: none', data-bind='visible: true, foreach: visibleMessages')
      .infokala-message(data-bind='attr: {id: "infokala-message-" + id}, css: {"infokala-message-cycleable": isCycleable, "infokala-message-deleted": isDeleted, "infokala-open": isMessageOpen}')
        .row.infokala-action-row
          .col-md-12.text-muted
            .pull-right
              span.infokala-state-switcher(data-bind='visible: isCycleable(), click: cycleMessageState')
                span.label(data-bind='text: state().name, css: state().labelClass')
                span.infokala-next-state(data-bind='with: nextState()')
                  span.text-muted &thinsp;&rArr;&thinsp;
                  span.label(data-bind='text: name, css: labelClass')
              | &emsp;
              span.label.label-default(data-bind='visible: $parent.shouldShowMessageType(), text: messageType.name')
              | &emsp;
              span.infokala-comments-button(data-bind='visible: commentAmount() > 0, click: toggleOpen')
                span.btn.btn-xs.btn-info(data-bind='html: "&#x1f4ac; " + commentAmount()')
                | &emsp;
              span.btn.btn-xs.btn-primary.infokala-edit-message-button(data-bind='click: toggleEdit, clickBubble: false') &#x270e;
              | &emsp;
              span.btn.btn-xs.btn-danger.infokala-delete-message-button(data-bind='click: deleteMessage, clickBubble: false') &times;
            .small(data-bind='text: formattedTime')

        .row.infokala-message-text(data-bind='css: {"infokala-inactive": !state().active}, click: toggleOpen')
          strong.col-md-1(data-bind='text: author')
          .col-md-9(data-bind='text: message, visible: !isEditingOpen(), css: {"infokala-edit-pending": isEditPending}')
          form.col-md-9(data-bind='submit: handleEdit', role='form')
            input.form-control.infokala-edit-field(type='text', data-bind='textInput: newText, visible: isEditingOpen, click: function(){}, clickBubble: false, event: {blur: handleEdit}')

        .infokala-message-history(data-bind='visible: isMessageOpen, click: toggleOpen')
          .row
            .col-md-12.h5.infokala-history-header Kommentoi
          .row.infokala-comment-form
            .col-md-1
            .col-md-1.infokala-timestamp(data-bind='text: (new Date()).toLocaleTimeString("fi-FI").replace(/\\./g, ":")')
            .col-md-1(data-bind='text: $parent.author() + ":"')
            form.col-md-8(data-bind='submit: handleComment, disabled: isCommentPending, click: function(){}, clickBubble: false', role='form')
              input.form-control.infokala-comment-field(type='text', data-bind='textInput: newComment')
          .row
            .col-md-1
            .col-md-11.h5.infokala-history-header Historia
          .infokala-message-event-container(data-bind='foreach: eventList')
            .row.infokala-message-event
              .col-md-1
              .col-md-1.infokala-timestamp(data-bind='text: time')
              .col-md-1(data-bind='text: author + ":"')
              .col-md-9(data-bind='html: html, css: classes')

    .container(style='display: none', data-bind='visible: true')
      form.infokala-message-form(data-bind='submit: sendMessage', role='form')
        .row
          .col-md-1.infokala-author-col
            input.form-control(data-bind='value: author')
          .infokala-message-col(data-bind='css: { "col-md-9": shouldShowMessageType(), "col-md-11": !shouldShowMessageType(), "infokala-message-col-middle": shouldShowMessageType() }')
            input.form-control(data-bind='value: message', placeholder='Viesti...')
          .col-md-2.infokala-message-type-col(data-bind='visible: shouldShowMessageType()')
            select.form-control(data-bind='options: config.messageTypes, optionsText: "name", optionsValue: "slug", value: manualMessageType')
        input.hidden(type='submit')
